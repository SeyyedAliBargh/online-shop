<!--
ðŸ“¦ Context Notes for Frontend Developer
----------------------------------------
In this template, we have access to the variable: **products**

Each `product` object contains the following properties (from the Product model):

ðŸ§¾ Basic Info:
    - id: integer â†’ unique product ID
    - name: string â†’ product name
    - description: text â†’ full description
    - slug: string â†’ used for product detail URL
    - category: object â†’ related category (use `product.category.name` for its name)
    - brand: string â†’ product brand (optional)
    - weight: integer â†’ weight in grams
    - inventory: integer â†’ available stock count

ðŸ’° Pricing:
    - original_price: integer â†’ base price (before discount)
    - discount: integer â†’ discount percent (0â€“100)
    - discounted_price: integer â†’ price after applying discount

â­ Ratings:
    - average_rating: decimal (e.g., 4.25) â†’ average user rating
    - rating_count: integer â†’ number of users who rated the product

ðŸ“ˆ Statistics:
    - views: integer â†’ total product views
    - sold_count: integer â†’ total units sold

ðŸ“… Dates:
    - created_at: datetime (jalali) â†’ creation date
    - updated_at: datetime (jalali) â†’ last updated

ðŸ–¼ï¸ Related Data:
    - images: list of Image objects â†’ each image has:
{#        * image_file â†’ URL of product image (use {{ image.image_file.url }})#}
        * title â†’ image title
        * description â†’ optional image description
    - features: list of ProductFeature objects â†’ each has:
        * name â†’ feature title (e.g., "Color", "Size")
        * value â†’ feature value (e.g., "Green", "500g")
    - comments: list of Comment objects â†’ each comment has:
{#        * user â†’ comment author (use {{ comment.user.username }})#}
        * body â†’ comment text
        * created â†’ creation date
        * replies â†’ nested comments (if exist)
    - ratings: list of Rating objects â†’ each rating has:
        * user â†’ who rated the product
        * score â†’ integer from 1 to 5

âš™ï¸ Useful Django Template Access Examples:
{#    {{ product.name }}#}
{#    {{ product.discounted_price }}#}
{#    {{ product.images.first.image_file.url }}#}
{#    {{ product.features.all }}#}
{#    {{ product.comments.count }}#}
{#    {{ product.get_absolute_url }}#}

----------------------------------------
ðŸ’¡ Note:
If you're displaying multiple products (e.g., product list page),
{#`products` will likely be a queryset (loop with `{% for product in products %}`).#}

If you're displaying a single product (e.g., detail page),
{#youâ€™ll access fields directly (e.g., `{{ product.name }}`, `{{ product.description }}`).#}
----------------------------------------
-->
{% extends 'parent/base.html' %}
{% load static %}
{% block head %}
{% endblock %}

{% block content %}

    <main>
        <div class="container">
            <div class="products-list">
                <ul class="products-list__li">
                    {% for product in products %}
                        <li class="products-list__ele">
                            <a class="products-lists__link" href="{{ product.get_absolute_url }}">
                                <div class="img-box">
                                    <img class="img-box__img" src="{{ product.images.first.image_file.url }}" alt="products list">
                                </div>
                                <a href="{% url 'shop:product_detail' slug=product.slug %}">
                                <div class="name-box">
                                    <h5 class="name-box__text">{{ product.name | truncatechars:50  }}</h5>
                                </div>
                                </a>
                                <div class="rating-box">
                                    <p class="rating-box__text">{{ product.average_rating  }}</p>
                                    <span class="rating-box__svg">â˜…</span>
                                </div>
                                <div class="price-box">
                                    {% if product.discount is not None %}
                                        <div class="price-box__discount"><span>{{ product.discount }}%</span></div>
                                        <div class="price-box__dic__price"><span>ØªÙˆÙ…Ø§Ù†{{ product.discount_price }}</span></div>
                                    {% else %}
                                        <div class="price-box__original">ØªÙˆÙ…Ø§Ù†<span class="price-box__original">{{ product.original_price }}</span></div>
                                    {% endif %}
                                </div>
                                {% if product.discount is not None %}
                                <div class="original-box">
                                    <p class="original-box__price">{{ product.original_price }}</p>
                                </div>
                                {% endif %}
                            </a>
                        </li>
                    {% endfor %}
                </ul>

            </div>
        </div>
    </main>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    $(document).ready(function (){
        let page = 2;
        let loading = false;

        $(window).on('scroll', function (){
            let lastPost = $('.post').last();
            if (lastPost.length === 0) return;

            let scrollTop = $(window).scrollTop();
            let windowHeight = $(window).height();
            let postOffset = lastPost.offset().top;
            if (scrollTop + windowHeight >= postOffset - 100) {
                loadMoreProducts();
        }

    })

        function loadMoreProducts(){
            if (loading) return;
            loading = true;
            $.ajax({
                type: 'GET',
                url: '{% url "shop:products_list" %}' + '?page=' + page,
                dataType: 'html',
                success: function (response){
                    $('.products_list').append(response)
                }
            })
        }
    })
</script>

{% endblock %}